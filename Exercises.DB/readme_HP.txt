ΕΡΓΑΣΙΑ ΥΣΒΔ
Γεώργιος Τζάθας sdi1600168
Χρήστος Καρούσης sdi1900078


Eκτελέσιμα:
make hp
make ht
make sht
Εντολη make clean για να διαγραψει ολα τα αρχεια που τελειωνουν σε .db


Αρχειο Σωρου:

Οριζω στο header file τη δομη HP_info που περιεχει ενα string για τον τυπο αρχειου, το fd και δεικτη στο τελευταιο μπλοκ. Η δομη HP_block_info κραταει τον αριθμο 
εγγραφων στο μπλοκ σε καθε δεδομενη στιγμη. Δε χρειαζομαστε καποιον δεικτη στο επομενο μπλοκ εδω, θα χρειαστει μονο στο αχειο κατακερματισμου. Επισης οριζω το μεγιστο 
αριθμο εγγραφων σε καθε μπλοκ σαν macro.

Η HP_CreateFile δημιουργει το αρχειο και χρησιμοποιει το 1ο μπλοκ του για να κραταει τη δομη με τις πληροφοριες. Οποτε ανοιγει το αρχειο για να αρχικοποιησει τη δομη και 
μετα το ξανακλεινει. Η HP_OpenFile ανοιγει το αρχειο, ανακτα αυτες τις πληροφοριες απ το 1ο μπλοκ, παραχωρει γι αυτες καινουρια μνημη με malloc και επιστρεφει στη main 
τον καινουριο δεικτη. Επειδη δεν επιστρεφει int οπως οι αλλες συναρτησεις αλλα struct pointer, εχω αντικαταστησει τις κλησεις CALL_BF με ελεγχους που σπιστρεφουν NULL σε 
περιπτωση λαθους. Το αρχειο παραμενει ανοιχτο και η μνημη που παραχωρηθηκε αποδεσμευεται στην HP_CloseFile οπου κλεινει το αρχειο.

Η HP_insert_on_new_block ειναι μια εξτρα συναρτηση που κατασκευασα σαν βοηθητικη για την εισαγωγη. Αυτο επειδη θα χρειαστει να κληθει σε 2 διαφορετικες περιπτωσεις απο 
την HP_InsertEntry. Η λειτουργια της ειναι να παραχωρησει καινουριο μπλοκ (το οποοιο γινεται παντα στο τελος του αρχειου) και να εισαγει την καινουρια εγγραφη στην αρχη 
του. Σε καθε καινουριο μπλοκ πρεπει επισης να γραφονται τα metadata (block_info) στο τελος του, οποτε κανει και αυτο βαζοντας καταλληλο offset στη memcpy. Τελος πρεπει 
να ενημερωσει την HP_info για τις αλλαγες και να την ξαναγραψει στο 1ο μπλοκ (εφοσον ειναι 2 διαφορετικοι pointers).

Η HP_InsertEntry εισαγει μια καινουρια εγγραφη στο τελος του αρχειου. Υπαρχουν 2 κεντρικες περιπτωσεις: Αν το αρχειο ειναι αδειο θελουμε καινουριο μπλοκ οποτε καλειται η 
HP_insert_on_new_block. Αν το αρχειο δεν ειναι αδειο τοτε υπαρχουν 2 υποπερπτωσεις. Αν το τελευταιο μπλοκ ειναι γεματο τοτε και παλι καλειται η HP_insert_on_new_block. 
Αν δεν ειναι γεματο τοτε γινεται η εισαγωγη της εγγραφης μετα απ τις προηγουμενες με καταλληλο offset.

H HP_GetAllEntries κανει αναγκαστικα σειριακη αναζητηση σε ολο το αρχειο για να βρει τις εγγραφες με ενα συγκεκρμενο value, αφου δεν υπαρχει καποια οργανωση στο αρχειο 
σωρου που να κανει την αναζητηση πιο αποδοτικη. Αυτο γινεται με 2 εμφωλευμενες for loops, μια για καθε μπλοκ του αρχειου και μια για καθε εγρρφαη στο μπλοκ.

H main απλα τεσταρει ολες τις παραπανω συναρτησεις φτιαχνοντας μια βαση δεδομενων HP_data.db με 1000 τυχαιες εγγραφες.
